jQuery(function(n){n(".with-tip").tooltip(),n(".js-show-index-filters").click(function(){n(".filter-well").slideToggle(),n(this).parents(".filter-wrap").toggleClass("collapsed"),n("span.icon",n(this)).toggleClass("icon-chevron-down")}),n("#main-sidebar").find('[data-toggle="collapse"]').on("click",function(){1==n(this).find(".icon-chevron-left").length?n(this).find(".icon-chevron-left").removeClass("icon-chevron-left").addClass("icon-chevron-down"):n(this).find(".icon-chevron-down").removeClass("icon-chevron-down").addClass("icon-chevron-left")}),n("#sidebar-toggle").on("click",function(){var e=n("#wrapper"),t=n("#main-part"),a=n("#main-sidebar"),i="col-xs-12 sidebar-collapsed",s="col-xs-9 col-xs-offset-3 col-md-10 col-md-offset-2";e.toggleClass("sidebar-minimized"),a.toggleClass("hidden-xs"),t.toggleClass(i).toggleClass(s),e.hasClass("sidebar-minimized")?n.cookie("sidebar-minimized","true",{path:"/admin"}):n.cookie("sidebar-minimized","false",{path:"/admin"})}),n(".sidebar-menu-item").mouseover(function(){n("#wrapper").hasClass("sidebar-minimized")&&(n(this).addClass("menu-active"),n(this).find("ul.nav").addClass("submenu-active"))}),n(".sidebar-menu-item").mouseout(function(){n("#wrapper").hasClass("sidebar-minimized")&&(n(this).removeClass("menu-active"),n(this).find("ul.nav").removeClass("submenu-active"))}),n(".js-quick-search").val(n(".js-quick-search-target").val()),n("#quick-search").submit(function(){return n(".js-quick-search-target").val(n(".js-quick-search").val()),n("#table-filter form").submit(),!1});var e=n("#main-sidebar").find(".selected");e.closest(".nav-pills").addClass("in"),e.closest(".nav-sidebar").find(".icon-chevron-left").removeClass("icon-chevron-left").addClass("icon-chevron-down"),n(".sort_link").each(function(){var e=n(this).text().replace("\xa0","");0<=e.indexOf("\u25bc")?(n(this).text(e.replace("\u25bc","")),n(this).append('<span class="icon icon-chevron-down"></span>')):0<=e.indexOf("\u25b2")&&(n(this).text(e.replace("\u25b2","")),n(this).append('<span class="icon icon-chevron-up"></span>'))}),n(".js-add-filter").click(function(){var e=n(this).data("ransack-field"),t=n(this).data("ransack-value");n("#"+e).val(t),n("#table-filter form").submit()}),n(document).on("click",".js-delete-filter",function(){var e=n(this).parents(".js-filter").data("ransack-field");n("#"+e).val(""),n("#table-filter form").submit()}),n(".js-filterable").each(function(){var e=n(this);if(e.val()){var t,a,i=e.attr("id"),s=n('label[for="'+i+'"]');t=e.is("select")?e.find("option:selected").text():e.val(),a='<span class="js-filter label label-default" data-ransack-field="'+i+'">'+(s=s.text()+": "+t)+'<span class="icon icon-delete js-delete-filter"></span></span>',n(".js-filters").append(a).show()}}),n(".js-per-page-select").change(function(){var e=n(this).closest(".js-per-page-form").attr("action"),t=n(this).val().toString();e.match(/\?/)?e+="&per_page="+t:e+="?per_page="+t,window.location=e}),n(document).ready(function(){var e=n(".js-per-page-select:first");if(e.length){var t='<input type="hidden" name="per_page" value='+e.val().toString()+" />";n("#table-filter form").append(t)}}),setTimeout('$(".alert-auto-disappear").slideUp()',5e3)}),$.fn.visible=function(e){this[e?"show":"hide"]()},show_flash=function(e,t){var a=$(".alert-"+e);0==a.length&&(a=$('<div class="alert alert-'+e+'" />'),$("#content").prepend(a)),a.html(t).show().delay(1e4).slideUp()},$.fn.radioControlsVisibilityOfElement=function(e){this.get(0)&&(showValue=this.get(0).value,radioGroup=$("input[name='"+this.get(0).name+"']"),radioGroup.each(function(){$(this).click(function(){$(e).visible(this.checked&&this.value==showValue)}),this.checked&&this.click()}))},handle_date_picker_fields=function(){$(".datepicker").datepicker({dateFormat:Spree.translations.date_picker,dayNames:Spree.translations.abbr_day_names,dayNamesMin:Spree.translations.abbr_day_names,firstDay:Spree.translations.first_day,monthNames:Spree.translations.month_names,prevText:Spree.translations.previous,nextText:Spree.translations.next,showOn:"focus"}),$(".date-range-filter .datepicker-from").datepicker("option","onSelect",function(e){$(".date-range-filter .datepicker-to").datepicker("option","minDate",e)}),$(".date-range-filter .datepicker-to").datepicker("option","onSelect",function(e){$(".date-range-filter .datepicker-from").datepicker("option","maxDate",e)})},$(document).ready(function(){handle_date_picker_fields(),$(".observe_field").on("change",function(){target=$(this).data("update"),$(target).hide(),$.ajax({dataType:"html",url:$(this).data("base-url")+encodeURIComponent($(this).val()),type:"get",success:function(e){$(target).html(e),$(target).show()}})});var i=1;$(".spree_add_fields").click(function(){var e=$(this).data("target"),t=$(e+" tr:visible:last").clone(),a=(new Date).getTime()+i++;t.find("input, select").each(function(){var e=$(this);e.val(""),e.prop("id",e.prop("id").replace(/\d+/,a)),e.prop("name",e.prop("name").replace(/\d+/,a))}),t.find("a").each(function(){$(this).prop("href","#")}),$(e).prepend(t)}),$("body").on("click",".delete-resource",function(){var e=$(this);return confirm(e.data("confirm"))&&$.ajax({type:"POST",url:$(this).prop("href"),data:{_method:"delete",authenticity_token:AUTH_TOKEN},dataType:"script",success:function(){$(".alert-success").length&&e.parents("tr").fadeOut("hide",function(){$(this).remove()})},error:function(e){show_flash("error",e.responseText)}}),!1}),$("body").on("click","a.spree_remove_fields",function(){return el=$(this),el.prev("input[type=hidden]").val("1"),el.closest(".fields").hide(),"#"==el.prop("href").substr(-1)?el.parents("tr").fadeOut("hide"):el.prop("href")&&$.ajax({type:"POST",url:el.prop("href"),data:{_method:"delete",authenticity_token:AUTH_TOKEN},success:function(){el.parents("tr").fadeOut("hide",function(){$(this).remove()})},error:function(e){show_flash("error",e.responseText)}}),!1}),$("body").on("click",".select_properties_from_prototype",function(){$("#busy_indicator").show();var e=$(this);return $.ajax({dataType:"script",url:e.prop("href"),type:"get",success:function(){e.parent("td").parent("tr").hide(),$("#busy_indicator").hide()}}),!1});var e=function(e,t){return t.children().each(function(){$(this).width($(this).width())}),t};$("table.sortable").ready(function(){var a=$(this).find("tbody tr:first-child td").length;$("table.sortable tbody").sortable({handle:".handle",helper:e,placeholder:"ui-sortable-placeholder",update:function(e,t){var a=this;$("#progress").show(),positions={},$.each($("tr",a),function(e,t){reg=/spree_(\w+_?)+_(\d+)/,parts=reg.exec($(t).prop("id")),parts&&(positions["positions["+parts[2]+"]"]=e+1)}),$.ajax({type:"POST",dataType:"script",url:$(t.item).closest("table.sortable").data("sortable-link"),data:positions,success:function(){$("#progress").hide()}})},start:function(e,t){t.placeholder.height(t.item.height()),t.placeholder.html("<td colspan='"+(a-1)+"'></td><td class='actions'></td>")},stop:function(){$("table.sortable tr:even").removeClass("odd even").addClass("even"),$("table.sortable tr:odd").removeClass("odd even").addClass("odd")}})}),$("a.dismiss").click(function(){$(this).parent().fadeOut()}),window.Spree.advanceOrder=function(){$.ajax({type:"PUT",async:!1,data:{token:Spree.api_key},url:Spree.url(Spree.routes.checkouts_api+"/"+order_number+"/advance")}).done(function(){window.location.reload()})}});